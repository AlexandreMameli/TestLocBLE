<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>test</h1>

    <button id="mbutt">Le bouton magique</button>
    <button id="but2">La Loc</button>
    <textarea id="loc"></textarea>
    <p id="dev"></p>
    <p id="chara"></p>
    <p id="t1"></p>
    <p id="t2"></p>
    <p id="t3"></p>
    <p id="nope"></p>
    <script>
        var laLoc = []
        document.querySelector("#but2").addEventListener("click", () => {
            navigator.geolocation.getCurrentPosition((position) => {
                    laLoc = [position.coords.latitude, position.coords.longitude]
                    document.querySelector("#loc").value = laLoc.toString()
                });
        })


        // document.querySelector("#mbutt").addEventListener("click", () => {
        //     navigator.bluetooth.requestDevice({acceptAllDevices:true, optionalServices: [0xAAAA]})
        //     // navigator.bluetooth.requestDevice({filters: [{services : [0xAAAA]}]})
        //     .then(device => {
        //         document.getElementById("dev").innerHTML = "dev: " + device.name
        //         return device.gatt.connect();
        //         })
        //     .then(server => {
        //         // Getting Service ou pas 1 2 test test...
        //         document.getElementById("t1").innerHTML = "connect ok";
        //         return server.getPrimaryServices(0xAAAA);
        //         })
        //     .then(service => {
        //         // Getting Service Characteristic...
        //         document.getElementById("t2").innerHTML = "service ok";
        //         return service.getCharacteristic(0xBBBB);
        //         })
        //     .then(characteristic => {
        //         document.getElementById("t3").innerHTML = "chara ok";
        //         return characteristic.readValue();
        //         })
        //     .then(value => {
        //         document.getElementById("chara").innerHTML = 'la valeur a pe changÃ© : ' + value;
        //         })
        //     .catch(error => {
        //         document.getElementById("nope").innerHTML = "nope " + error;
        // });
        
        
        // });

        let device, sendCharacteristic, receiveCharacteristic;
        document.getElementById("mbutt").onclick = async () => {
        device = await navigator.bluetooth
                    .requestDevice({acceptAllDevices:true, optionalServices: [0xAAAA]});

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService(0xAAAA);

        const receiveCharacteristic = await service.getCharacteristic(0xBBBB);
        const value = await receiveCharacteristic.readValue();
        document.getElementById("chara").innerHTML = 'la valeur ? : ' + value.getInt8(0);
        };



        </script>
</body>
</html>