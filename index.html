<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>test</h1>

    <button id="mbutt">Le bouton magique</button>
    <button id="but2">La Loc</button>
    <textarea id="loc"></textarea>
    <p id="dev"></p>
    <p id="chara"></p>
    <script>

        document.querySelector("#but2").addEventListener("click", () => {
            navigator.geolocation.getCurrentPosition((position) => {
                    document.querySelector("#loc").value = position.coords.latitude + "  " + position.coords.longitude
                }); 
        })
        
        option = {
            filters: [
                {services : [0xAAAA]},
                {name: 'LeLopy'}
        ]
        };
    
        document.querySelector("#mbutt").addEventListener("click", () => {
            navigator.bluetooth.requestDevice(option)
            .then(device => {
                document.getElementById("dev").innerHTML = "dev: " + device.name
                return device.gatt.connect();
                })
            .then(server => {
                // Getting Service...
                return server.getPrimaryService(0xAAAA);
                })
            .then(service => {
                // Getting Service Characteristic...
                return service.getCharacteristic(0xBBBB);
                })
            .then(characteristic => {
                // Reading Characteristic
                return characteristic.readValue();
                })
            .then(value => {
                document.getElementById("chara").innerHTML = 'la valeur : ' + value.getUint8(0);
                })

            .catch(error => {
                console.log("nope");
        });
        })

        
        </script>
</body>
</html>