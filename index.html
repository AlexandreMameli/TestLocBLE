<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>test</h1>

    <button id="mbutt">Le bouton magique</button>
    <button id="but2">La Loc</button>
    <textarea id="loc"></textarea>
    <p id="dev"></p>
    <p id="chara"></p>
    <p id="t1"></p>
    <p id="t2"></p>
    <p id="nope"></p>
    <script>
        var laLoc = []
        document.querySelector("#but2").addEventListener("click", () => {
            navigator.geolocation.getCurrentPosition((position) => {
                    laLoc = [position.coords.latitude, position.coords.longitude]
                    document.querySelector("#loc").value = laLoc.toString()
                }); 
        })
        
        option = {
            filters: [
                {services : [0xAAAA]},
                {name: 'leLopy'}
        ]
        };
    
        document.querySelector("#mbutt").addEventListener("click", () => {
            navigator.bluetooth.requestDevice({acceptAllDevices:true, optionalServices:[0xAAAA]})
            .then(device => {
                document.getElementById("dev").innerHTML = "dev: " + device.name
                return device.gatt.connect();
                })
            .then(server => {
                // Getting Service ou pas 1 2 test test...
                document.getElementById("t1").innerHTML = "services : " + server.getPrimaryServices(0xAAAA).toString();
                return server.getPrimaryServices(0xAAAA);
                })
            .then(service => {
                // Getting Service Characteristic...
                document.getElementById("t2").innerHTML = "chara : " + service.getCharacteristic(0xBBBB);
                return service.getCharacteristic(0xBBBB);
                })
            .then(characteristic => {
                // n'ecris pas ?
                // var chara = characteristic.readValue() + 1;
                return characteristic.readValue();
                })
            .then(value => {
                document.getElementById("chara").innerHTML = 'la valeur a pe changÃ© : ' + value;
                })
            .catch(error => {
                document.getElementById("nope").innerHTML = "nope " + error;
        });
        })

        
        </script>
</body>
</html>